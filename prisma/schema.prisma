generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Level {
  LOW
  MIDDLE
  HIGH
}

model Numbeo {
  citySlug String @id
  city     City   @relation(fields: [citySlug], references: [slug])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  slug                       String
  safetyIndex                Decimal?
  climateIndex               Decimal?
  pollutionIndex             Decimal?
  purchasingPowerIndex       Decimal?
  healthCareIndex            Decimal?
  costOfLivingIndex          Decimal?
  propertyPriceToIncomeRatio Decimal?
  trafficCommuteTimeIndex    Decimal?
  isNumberData               Boolean  @default(true)

  climate Json?
}

enum Region {
  Europe
  Asia
  LatinAmerica
  NorthAmerica
  MiddleEast
  Africa
  Oceania
  Antarctica
}

model City {
  slug      String   @id
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  name         String
  country      String
  population   Int
  temperatureC Decimal @db.Decimal(4, 1)
  latitude     Decimal @db.Decimal(9, 6)
  longitude    Decimal @db.Decimal(9, 6)
  region       Region

  nameChinese    String
  countryChinese String
  airQualityNow  Int
  airQuality     Float?
  countryCode    String
  countrySlug    String
  stateCode      String?
  stateChinese   String?
  state          String?

  internetSpeedCity           Int
  internetSpeedCityRanking    Int
  internetSpeedCountry        Int
  internetSpeedCountryRanking Int

  airQualityScore    Int
  airQualityNowScore Decimal @db.Decimal
  humidity           String

  costForNomadInUsd  Decimal @db.Decimal
  costForExpatInUsd  Decimal @db.Decimal
  costForLocalInUsd  Decimal @db.Decimal
  costForFamilyInUsd Decimal @db.Decimal

  safety                Level?
  climate               Level?
  pollution             Level?
  purchasingPower       Level?
  healthCare            Level?
  costOfLiving          Level?
  propertyPriceToIncome Level?
  trafficCommuteTime    Level?

  isWeather2024Collected Boolean @default(false)

  weathers     Weather[]      @relation("cityWeather")
  monthSummary MonthSummary[] @relation("cityMonthSummary")

  imageId  Int?
  image    Image?
  numbeoId String?
  numbeo   Numbeo?
}

model Weather {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  date                     DateTime
  weatherCode              Int
  apparentTemperatureMax   Decimal?
  rainSum                  Decimal?
  windGusts10mMax          Decimal?
  snowfallSum              Decimal?
  windDirection10mDominant Decimal?
  daylightDuration         Decimal?
  apparentTemperatureMin   Decimal?
  temperature2mMax         Decimal?
  temperature2mMin         Decimal?
  apparentTemperatureMean  Decimal?
  sunshineDuration         Decimal?
  precipitationHours       Decimal?
  shortwaveRadiationSum    Decimal?
  windSpeed10mMax          Decimal?
  precipitationSum         Decimal?
  temperature2mMean        Decimal?

  citySlug String
  city     City   @relation("cityWeather", fields: [citySlug], references: [slug], onDelete: Cascade)

  @@unique([citySlug, date])
}

enum WeatherIcon {
  SUN
  CLOUDY
  WIND
  RAIN
  SNOW
  NULL
}

model MonthSummary {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  month                    String      @db.VarChar(2)
  weatherCode              Int
  apparentTemperatureMax   Decimal
  rainSum                  Decimal
  windGusts10mMax          Decimal
  snowfallSum              Decimal
  windDirection10mDominant Decimal
  daylightDuration         Decimal
  apparentTemperatureMin   Decimal
  temperature2mMax         Decimal
  temperature2mMin         Decimal
  apparentTemperatureMean  Decimal
  sunshineDuration         Decimal
  precipitationHours       Decimal
  shortwaveRadiationSum    Decimal
  windSpeed10mMax          Decimal
  precipitationSum         Decimal
  temperature2mMean        Decimal
  weatherIcon              WeatherIcon @default(NULL)

  popularity            Int      @default(0)
  region                Region
  population            Int?
  internetSpeedCity     Int?
  totalScore            Int      @db.SmallInt
  costForNomadInUsd     Decimal? @db.Decimal
  safety                Level?
  climate               Level?
  pollution             Level?
  purchasingPower       Level?
  healthCare            Level?
  costOfLiving          Level?
  propertyPriceToIncome Level?
  trafficCommuteTime    Level?

  citySlug String
  city     City   @relation("cityMonthSummary", fields: [citySlug], references: [slug], onDelete: Cascade)

  @@unique([citySlug, month])
  @@index([citySlug, month])
}

model Image {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  width            Int
  height           Int
  url              String  @unique
  blurHash         String?
  downloadLocation String
  ownerName        String
  ownerUsername    String?

  citySlug String? @unique
  city     City?   @relation(fields: [citySlug], references: [slug])
}
